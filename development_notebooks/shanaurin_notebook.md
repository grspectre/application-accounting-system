# Дневник разработчика Шанаурина Антона Александровича

## 2024-02-17 - 2024-03-01, Спринт 1

### 2024-02-19

Вчера провели собрание, пытаясь разобраться, что делать дальше. Спринт по сути не начался, дай бог в среду появится какой-то список задач. Ощущаю, что слишком много времени говорю, в результате получается какая-то импровизированная лекция.

Решили к среде набросать задач, а там можно и за спринт приниматься. Но репозиторий завели, коллабораторов набрали, дело движется.

### 2024-02-25

А вот и не движется. То есть вот вообще. Пока набросал какое-то количество задач, добавил задачи по администрированию сервера, создал сервер, делегировал домены. Дальше буду думать, потому что ничего непонятно. Очевидно, буду создавать документацию о воркфлоу в команде. Первый взгляд и всё такое. Вертолёт не летит, я пока толкаю змею в хвост. Плохо.

### 2024-02-01

В заключении получилось, что что-то начали. Пока из команды что-то делают двое, включая меня. Это немного печалит. Нужно провести ретро и спланировать следующий спринт.

## 2024-03-02 - 2024-03-15, Спринт 2

### 2024-03-09

Праздники не прошли даром, ничего не делал. Не только по проекту, конечно же. Вообще ничего не делал. Сегодня созванивались с Артёмом Кондря, разбирались с тем, как работать в GIT. Вроде даже разобрались.

### 2024-03-13

Создал папку с документацией, описал процесс работы с GIT в первом приближении.

### 2024-03-14

Создал каталог для fastapi, реализовал метод /ping, описал примерный процесс работы с venv. Но, по ощущениям этого будет недостаточно.

### 2024-03-15

Возился с сервером. Пока не очень понятно, но надо что-то простое пока сделать. uvicorn, nginx, хотя бы сред 4 + продакшн. Подумать о докере, хотя мысль о сборке образа угнетает. Я не очень понимаю техпроцесс, надо тренироваться.

### 2024-03-16

Сижу и пишу дневник разработки перед парой. Да, привычка делать всё в последний момент - плохая привычка. Нужно выделить хотя бы полчаса каждый день, поставить задачу об организации коллектива, продумать шаги. Сегодня выделить час на планирование. Или на выходные, как пойдёт. Всё также плохо, движение не наблюдается, видимо, буду пинать. Прямо интересно.

## 2024-03-16 - 2024-03-29, Спринт 3

### 2024-03-29

Посмотрел на то, как всё движется, посмотрел, что происходит на сервере (PHP! Шта?!), психанул, настроил прод (nginx не умеет работать с несколькими пользователями, печаль), настроил одну тестовую среду. Потратил по сути всю пятницу, так делать не надо. Нужно размазывать эти 8 часов на 2 недели. Попробую сделать это в следующий стрим.

## 2024-03-30 - 2024-04-08, Спринт 4

### 2024-03-30

В основном разговаривали. Я решил, что на этой неделе делаем авторизацию. Николай Петров хочет вкатить keycloak, ну а почему бы и да? Как он будет дружить это с нашим бекендом пока не особо понятно, ну а вдруг! Да и получение данных по пользователе и изменение им своих данных в профиле тоже пока непонятно как будет происходить.

Вообще, конечно, инициатором работы с пользователем может быть клиент, но история эта немного странная. То есть по сути внешний клиент знает методы АПИ и знает что-то о пользователе. Бекенд по сути просто что-то сохраняет и что-то возвращает. Даже думать не хочу. 

- Клиент: Я пользователь 1! Вот мой паспорт! (даёт токен, притом вечный токен)
- Бек: У меня нет такого пользователя!
- Клиент: Создай пользователя 1 вот с этими данными!
- Бек: На тебе refresh-токен. Храни его!

Зачем там refresh-токен - непонятно. Обмениваем токен  keycloak на наш быстрый токен (на час или на сутки, не важно) да и всё. Не значаешь токен keycloak - идёшь нафиг создавать нового пользователя. А то ходют тут всякие без пачпорта!

### 2024-03-31

Вкатил локально alembic и даже что-то заработало. По крайней мере сделать upgrade мне удалось. crud пока делать не стал, потому что особой надобности нет, а там кто-нибудь сделает. Или не сделает. Посмотрим, как пойдёт. Пока есть только таблица users.

### 2024-04-01

Выкатил на сервер прод и первую среду разработки. Сломал прод. Починил прод. Написал документацию. Ми-ми-ми.

### 2024-04-04

На днях пришла гениальная мысль, что нафиг keycloak, есть Яндекс.ID. Радостно вкатывал Яндекс.ID. Да, на неделе, может, появится Let's Encrypt. Радость-радость. Но работать-то как-то надо! Сегодня с утра думал о том, что метод создания пользователя принципиально не нужен. Достаточно пока одного get, который прозрачно создаёт пользователя из токена Яндекс.Директ. Вообще, конечно, ещё нужно писать middleware для аутентификации. То есть получаем токен, ищем в базе, если в базе не находим, пытаемся сделать запрос к Яндекс.ID, если не получается, отфутболиваем. По идее нужно ещё считать попытки. Чтобы Яндекс.ID сильно не дёргать. Надо посмотреть, как fastapi делает throttle. Если делает. Ладно, в субботу надо сделать собрание.

### 2024-04-08

Вчера провели собрание, час проговорили. Если сравнивать с предыдущим спринтом, то дела идут лучше. Очевидно, что кто-то один придумывать задачи и распределять их. И не быть при этом играющим тренером. Или быть? Сложный вопрос. В любом случае спринтом я более или менее доволен, потому что дело сдвинулось с мёртвой точки. Возможно, имеет смысл написать, что я ожидаю в конце.

## 2024-04-09 - 2024-04-22, Спринт 5

### 2024-04-14

Как-то пять дней прошло, а я ничего не делал. Так что решил написать метод /api/user, но что-то пошло не так, uvicorn сломался, я ничего не понимаю, так что полчаса потратил в попытках оживить вот всё это вот. На самом деле такое себе по сути. Как это тестировать - совершенно непонятно. Что сломалось - тоже не очень понятно. Хоть реально уходи на какую-нибудь убунту и разрабатывай там. Ну да ладно, полтора часа коту под хвост, но утро вечера мудренее.

### 2024-04-15

Наверное, Windows не очень подходит для разработки на fastapi или uvicorn не так хорош на этой операционной системе. По крайней мере я понял, как перезагрузить всё: `taskkill /f /im "python.exe"`. Потому что ключ `--reload` у `uvicorn` не работает так, как мне хотелось бы. Возможно, это связано с тем, что это middleware. Ладно, будем дальше двигаться вперёд небольшими шагами.

### 2024-04-17

Кто написал первый middleware и первый метод, тот я. Кто фигакнул токен от моего Яндекс.Паспорта в репозиторий - тот тоже я. Вообще было весело. Теперь можно заняться самим приложением. По крайней мере что-то начать делать. Не то, чтобы я любил фронтенд, но делать же надо! Так что погнали дальше.

### 2024-04-22

Кто сделал авторизацию, тот я. А может аутентификацию, я постоянно путаюсь в этих терминах, да и не суть. Надо глянуть, сколько на это потратил. 2:43 Терпимо. Хотя мог бы позалипать в онеме. И так, что мы имеем на данный момент? Мы можем войти с помощью Яндекс.Паспорта. Мы можем выйти. И снова войти.

Затащили axios, dexie (ваще первое, что нашёл в интернете, если честно) и повспоминали alpine. Код говно, но работает. По сути до минимального приложения осталось форма заявки и изменение статусь. Я молодец и плохой тимлид, ну да первый блин комом. Это всё из-за того, что я никого не могу уволить! Как будто, если бы ты был тимлидом, тебе бы дали кого-нибудь уволить... Ладно, танцуем дальше.

### 2024-04-23

Прод обновил, напоминание в группу в телеграме писать дневники и барьеры написал. Я молодец, я сделал на этом спринте всё, что хотел сделать. Надо попробовать собрания. Хотя что-то эта идея мне кажется сомнительной. То есть на следующий спринт я попытаюсь сделать следующее:

1. Допилить проект до минимального функционала.
2. Попробовать проводить собрания хотя бы через день. Буду сидеть в одного и тупить.

## 2024-04-23 - 2024-05-06, Спринт 6

### 2024-04-25

Ну да, ну да, раньше воскресенья и никого не жду по сути. Да и воскресенье под вопросом. Ладно, работаем потихоньку дальше. Создал таблицу `order`. И даже мигрировал. Не знаю, насколько рабочие внешние ключи, но, допустим, я всё сделал правильно. В процессе осознал, что обновить все тестовые среды мне проще, чем описывать, как это сделать. Потому что что? Правильно! Ко мне же и придут с вопросами, а я потрачу больше времени. Придут ли?.. Да-да-да, нужно назначать встречи. Нужно подпинывать. Как их там называют? friendly reminder, ага.


### 2024-04-28

Ладно, чем дальше в лес, тем толще партизаны. Сколько у меня времени ушло на task-25? 1:53 Терпимо. Что там осталось? get-запрос, list-запрос. Структура /api/order и /api/orders? Или /api/order/list? Ну да, у меня не graphQL, мне можно. Ой, посмотри на Яндекс: там есть объект и действия с объектом, то есть order/get, order/add, order/update order/suspend, если он нужен такой красивый. По сути они подменяют HTTP, но это не повод. Так что схема /api/order - это объект, с которым доступны какие-то действия с помощью HTTP-методов, а всё специфическое типа list и status уезжает уровнем ниже, то есть /api/order/status и /api/order/list. Тут одной схемы придерживаться, хотя потом всё можно поправить. Ой, забей.

Криво, косо, но сойдёт. До вторника добъёшь методы апишечки - будешь няшкой.

### 2024-05-01

Ну шо, осталось три недели, а задач только прибавляется?.. Бгг. Ладно, с документацией в фастапи непонятно, проще взять `scalar` и фигачить на нём. Получение списка я сделал. Теперь можно сделать первую итерацию интерфейса, то есть добавление заказа и вывод списка. Потом назначение менеджера, видимо, добавлю роль администратора, а потом, собственно управление. И всё это за неделю! Вперёд, на баррикады! Да, а ещё презентация, куда ж без неё. Ещё бы время где-нибудь взять.

### 2024-05-01 - Запись 2

Примитивный интерфейс прикрутили, axios прикольный. На сегодня всё. Сейчас обновлю prod и dev и пойду отдыхать. А завтра чем-нибудь другим весёлым займусь.

### 2024-05-07

Работа потихоньку движется. В выходные провели собрание, пообщались о ситуации на проекте. Надежда потихоньку стала делать верстку и уже что-то получается. Нужно допинать и показать что-то относительно законченное. Провёл презентацию в импровизированном формате. Работаем дальше.

